<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîî –ú–æ–Ω—ñ—Ç–æ—Ä –∑–∞—è–≤–æ–∫ PC-Master</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .status {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .status-card {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.2);
            min-width: 200px;
        }
        
        .status-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        
        .status-value {
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
        }
        
        .controls {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border: 1px solid rgba(255,255,255,0.2);
        }
        
        .controls h2 {
            margin-bottom: 15px;
            text-align: center;
        }
        
        .control-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .control-group label {
            font-weight: bold;
        }
        
        .control-group input,
        .control-group select {
            padding: 10px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
        }
        
        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }
        
        .btn.warning {
            background: linear-gradient(45deg, #fdcb6e, #e17055);
        }
        
        .notifications {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(255,255,255,0.2);
            max-height: 500px;
            overflow-y: auto;
        }
        
        .notification-item {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid #ffd700;
            animation: slideIn 0.5s ease;
        }
        
        .notification-item.new {
            border-left-color: #ff6b6b;
            background: rgba(255, 107, 107, 0.2);
        }
        
        .notification-time {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .notification-content {
            font-weight: bold;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        .alert {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            z-index: 9999;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: alertBounce 0.5s ease;
        }
        
        @keyframes alertBounce {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîî –ú–æ–Ω—ñ—Ç–æ—Ä –∑–∞—è–≤–æ–∫ PC-Master</h1>
            <p>–°–∏—Å—Ç–µ–º–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–∞—Å—É –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –∑–∞—è–≤–æ–∫</p>
        </div>
        
        <div class="status">
            <div class="status-card">
                <h3>üìä –°—Ç–∞—Ç—É—Å</h3>
                <div class="status-value" id="status">–û—á—ñ–∫—É–≤–∞–Ω–Ω—è</div>
            </div>
            <div class="status-card">
                <h3>üìà –ó–∞—è–≤–æ–∫ —Å—å–æ–≥–æ–¥–Ω—ñ</h3>
                <div class="status-value" id="todayCount">0</div>
            </div>
            <div class="status-card">
                <h3>‚è∞ –û—Å—Ç–∞–Ω–Ω—è –∑–∞—è–≤–∫–∞</h3>
                <div class="status-value" id="lastRequest">–ù–µ–º–∞—î</div>
            </div>
        </div>
        
        <div class="controls">
            <h2>‚öôÔ∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —É–≤–µ–¥–æ–º–ª–µ–Ω—å</h2>
            <div class="control-grid">
                <div class="control-group">
                    <label for="soundVolume">üîä –ì—É—á–Ω—ñ—Å—Ç—å –∑–≤—É–∫—É:</label>
                    <input type="range" id="soundVolume" min="0" max="100" value="80">
                </div>
                <div class="control-group">
                    <label for="soundType">üéµ –¢–∏–ø –∑–≤—É–∫—É:</label>
                    <select id="soundType">
                        <option value="emergency">üöë –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤</option>
                        <option value="alarm">üö® –¢—Ä–µ–≤–æ–≥–∞</option>
                        <option value="phone">üìû –¢–µ–ª–µ—Ñ–æ–Ω</option>
                        <option value="bell">üîî –î–∑–≤–æ–Ω–∏–∫</option>
                        <option value="siren">üö® –°–∏—Ä–µ–Ω–∞</option>
                        <option value="urgent">‚ö†Ô∏è –°—Ä–æ—á–Ω–æ</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="repeatCount">üîÅ –ü–æ–≤—Ç–æ—Ä—ñ–≤:</label>
                    <select id="repeatCount">
                        <option value="1">1 —Ä–∞–∑</option>
                        <option value="3" selected>3 —Ä–∞–∑–∏</option>
                        <option value="5">5 —Ä–∞–∑—ñ–≤</option>
                        <option value="continuous">–ë–µ–∑–ø–µ—Ä–µ—Ä–≤–Ω–æ</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="notifications">üì± –ë—Ä–∞—É–∑–µ—Ä–Ω—ñ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è:</label>
                    <button class="btn" id="enableNotifications">–î–æ–∑–≤–æ–ª–∏—Ç–∏</button>
                </div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn warning" id="testSound">üéµ –¢–µ—Å—Ç –∑–≤—É–∫—É</button>
                <button class="btn" id="testNotification">üß™ –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è</button>
                <button class="btn success" id="startMonitoring">‚ñ∂Ô∏è –ü–æ—á–∞—Ç–∏ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</button>
                <button class="btn" id="stopMonitoring">‚èπÔ∏è –ó—É–ø–∏–Ω–∏—Ç–∏</button>
            </div>
        </div>
        
        <div class="notifications">
            <h2>üìã –ñ—É—Ä–Ω–∞–ª —É–≤–µ–¥–æ–º–ª–µ–Ω—å</h2>
            <div id="notificationList">
                <div class="notification-item">
                    <div class="notification-time">–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—É—â–µ–Ω–∞</div>
                    <div class="notification-content">‚úÖ –ú–æ–Ω—ñ—Ç–æ—Ä –∑–∞—è–≤–æ–∫ –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏</div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ó–≤—É–∫–æ–≤—ñ —Ñ–∞–π–ª–∏ -->
    <audio id="alarmSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvGk1Ci15yuzWiBkHIGu+9N2PQAxWsMj9g3hbEQMtddj8rF4WCj+n4PK2YyIGLIzS8MV8JwUdmtDz-" loop></source>
    </audio>
    <audio id="phoneSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvGk1Ci15yuzWiBkHIGu+9N2PQAxWsMj9g3hbEQMtddj8rF4WCj+n4PK2YyIGLIzS8MV8JwUdmtDz" loop></source>
    </audio>

    <script>
        class RequestMonitor {
            constructor() {
                this.isMonitoring = false;
                this.notifications = [];
                this.todayCount = 0;
                this.lastRequestTime = null;
                this.audioContext = null;
                this.currentSound = null;
                
                this.init();
            }
            
            init() {
                this.setupEventListeners();
                this.requestNotificationPermission();
                this.loadSettings();
                this.startHeartbeat();
            }
            
            setupEventListeners() {
                document.getElementById('testSound').addEventListener('click', () => this.testSound());
                document.getElementById('testNotification').addEventListener('click', () => this.testNotification());
                document.getElementById('startMonitoring').addEventListener('click', () => this.startMonitoring());
                document.getElementById('stopMonitoring').addEventListener('click', () => this.stopMonitoring());
                document.getElementById('enableNotifications').addEventListener('click', () => this.requestNotificationPermission());
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–≤—É–∫–∞
                document.getElementById('soundVolume').addEventListener('input', (e) => this.updateVolume(e.target.value));
                document.getElementById('soundType').addEventListener('change', () => this.saveSettings());
                document.getElementById('repeatCount').addEventListener('change', () => this.saveSettings());
            }
            
            async requestNotificationPermission() {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        this.showNotification('‚úÖ –ë—Ä–∞—É–∑–µ—Ä–Ω—ñ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ–∑–≤–æ–ª–µ–Ω—ñ');
                        document.getElementById('enableNotifications').textContent = '‚úÖ –ê–∫—Ç–∏–≤–Ω–æ';
                        document.getElementById('enableNotifications').classList.add('success');
                    }
                }
            }
            
            startMonitoring() {
                this.isMonitoring = true;
                document.getElementById('status').textContent = 'üü¢ –ê–∫—Ç–∏–≤–Ω–∏–π';
                document.getElementById('startMonitoring').disabled = true;
                document.getElementById('stopMonitoring').disabled = false;
                
                this.showNotification('üü¢ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞—è–≤–æ–∫ –∑–∞–ø—É—â–µ–Ω–æ');
                
                // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∞–ª—å–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                this.connectToServer();
            }
            
            stopMonitoring() {
                this.isMonitoring = false;
                document.getElementById('status').textContent = 'üî¥ –ó—É–ø–∏–Ω–µ–Ω–æ';
                document.getElementById('startMonitoring').disabled = false;
                document.getElementById('stopMonitoring').disabled = true;
                
                // –ó–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                if (this.eventSource) {
                    this.eventSource.close();
                    this.eventSource = null;
                }
                
                this.showNotification('üî¥ –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑—É–ø–∏–Ω–µ–Ω–æ');
            }
            
            // –°–∏–º—É–ª—è—Ü–∏—è –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫ (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
            simulateIncomingRequests() {
                if (!this.isMonitoring) return;
                
                const delay = Math.random() * 50000 + 10000;
                
                setTimeout(() => {
                    if (this.isMonitoring) {
                        this.handleNewRequest({
                            name: '–¢–µ—Å—Ç–æ–≤–∏–π –∫–ª—ñ—î–Ω—Ç',
                            phone: '+38 (097) 123-45-67',
                            service: '–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ Windows',
                            time: new Date()
                        });
                        this.simulateIncomingRequests();
                    }
                }, delay);
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–π –∑–∞—è–≤–∫–∏
            handleNewRequest(requestData) {
                this.todayCount++;
                this.lastRequestTime = new Date();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
                document.getElementById('todayCount').textContent = this.todayCount;
                document.getElementById('lastRequest').textContent = 
                    this.lastRequestTime.toLocaleTimeString('uk-UA');
                
                // –ó–≤—É–∫–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                this.playAlertSound();
                
                // –ë—Ä–∞—É–∑–µ—Ä–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                this.showBrowserNotification(requestData);
                
                // –í–∏–∑—É–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                this.showAlert(`üö® –ù–û–í–ê –ó–ê–Ø–í–ö–ê!\n${requestData.name}\n${requestData.phone}`);
                
                // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∂—É—Ä–Ω–∞–ª
                this.addToNotificationLog(requestData);
            }
            
            playAlertSound() {
                const volume = document.getElementById('soundVolume').value / 100;
                const soundType = document.getElementById('soundType').value;
                const repeatCount = document.getElementById('repeatCount').value;
                
                this.stopCurrentSound();
                
                // –°–æ–∑–¥–∞–Ω–∏–µ –∑–≤—É–∫–∞ —Å –ø–æ–º–æ—â—å—é Web Audio API
                this.createSound(soundType, volume, repeatCount);
            }
            
            createSound(type, volume, repeatCount) {
                if (!this.audioContext) {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–≤—É–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞
                switch(type) {
                    case 'emergency':
                        // –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–π –≤—ã–∑–æ–≤ - —á–∞—Å—Ç—ã–µ –≤—ã—Å–æ–∫–∏–µ —Å–∏–≥–Ω–∞–ª—ã
                        oscillator.frequency.setValueAtTime(1000, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1500, this.audioContext.currentTime + 0.1);
                        oscillator.frequency.exponentialRampToValueAtTime(1000, this.audioContext.currentTime + 0.2);
                        break;
                    case 'urgent':
                        // –°—Ä–æ—á–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ - –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π –∑–≤—É–∫
                        oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(1200, this.audioContext.currentTime + 0.3);
                        oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.6);
                        break;
                    case 'alarm':
                        oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(400, this.audioContext.currentTime + 0.5);
                        break;
                    case 'phone':
                        oscillator.frequency.setValueAtTime(440, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(880, this.audioContext.currentTime + 0.3);
                        break;
                    case 'bell':
                        oscillator.frequency.setValueAtTime(660, this.audioContext.currentTime);
                        break;
                    case 'siren':
                        oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);
                        oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 1);
                        break;
                }
                
                gainNode.gain.setValueAtTime(volume, this.audioContext.currentTime);
                
                // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–≤—É–∫–∞ –¥–ª—è —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤
                const duration = (type === 'emergency' || type === 'urgent') ? 2 : 1;
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start();
                oscillator.stop(this.audioContext.currentTime + duration);
                
                this.currentSound = oscillator;
                
                // –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ –∑–≤—É–∫–∞
                if (repeatCount !== '1' && repeatCount !== 'continuous') {
                    const repeats = parseInt(repeatCount) - 1;
                    for (let i = 1; i < repeats + 1; i++) {
                        const delay = (type === 'emergency') ? i * 500 : i * 1500; // –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —á–∞—â–µ
                        setTimeout(() => this.createSound(type, volume, '1'), delay);
                    }
                } else if (repeatCount === 'continuous') {
                    const delay = (type === 'emergency') ? 1000 : 2000; // –≠–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —á–∞—â–µ
                    setTimeout(() => this.createSound(type, volume, 'continuous'), delay);
                }
            }
            
            stopCurrentSound() {
                if (this.currentSound) {
                    try {
                        this.currentSound.stop();
                    } catch (e) {
                        // –ó–≤—É–∫ —É–∂–µ –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
                    }
                    this.currentSound = null;
                }
            }
            
            testSound() {
                this.playAlertSound();
                this.showNotification('üéµ –¢–µ—Å—Ç–æ–≤–∏–π –∑–≤—É–∫ –≤—ñ–¥—Ç–≤–æ—Ä–µ–Ω–æ');
            }
            
            // –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
            async testNotification() {
                try {
                    const response = await fetch('/api/test-notification', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        this.showNotification('‚úÖ –¢–µ—Å—Ç–æ–≤–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ');
                    } else {
                        this.showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è', 'error');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    this.showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                }
            }
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
            connectToServer() {
                if (typeof(EventSource) !== "undefined") {
                    this.eventSource = new EventSource('/monitor/events');
                    
                    this.eventSource.onmessage = (event) => {
                        try {
                            const data = JSON.parse(event.data);
                            this.handleServerEvent(data);
                        } catch (error) {
                            console.error('–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ SSE:', error);
                        }
                    };
                    
                    this.eventSource.onerror = (error) => {
                        console.error('SSE –æ—à–∏–±–∫–∞:', error);
                        this.showNotification('‚ùå –í—Ç—Ä–∞—á–µ–Ω–æ –∑\'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º', 'error');
                    };
                    
                    this.eventSource.onopen = () => {
                        this.showNotification('‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–æ –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');
                    };
                } else {
                    this.showNotification('‚ùå –ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î Server-Sent Events', 'error');
                    // Fallback –Ω–∞ —Å–∏–º—É–ª—è—Ü–∏—é
                    this.simulateIncomingRequests();
                }
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            handleServerEvent(data) {
                switch(data.type) {
                    case 'new_request':
                        this.handleNewRequest(data.data);
                        break;
                    case 'connected':
                        this.showNotification(data.message);
                        break;
                    case 'heartbeat':
                        // –ü—Ä–æ—Å—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
                        break;
                    default:
                        console.log('–ù–µ–≤—ñ–¥–æ–º–∏–π —Ç–∏–ø –ø–æ–¥—ñ—ó:', data);
                }
            }
            
            // –¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä
            async testNotification() {
                try {
                    const response = await fetch('/api/test-notification', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    });
                    
                    if (response.ok) {
                        this.showNotification('‚úÖ –¢–µ—Å—Ç–æ–≤–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ');
                    } else {
                        this.showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è', 'error');
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:', error);
                    this.showNotification('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞', 'error');
                }
            }
            
            showBrowserNotification(requestData) {
                if (Notification.permission === 'granted') {
                    new Notification('üö® –ù–æ–≤–∞ –∑–∞—è–≤–∫–∞ PC-Master!', {
                        body: `${requestData.name}\n${requestData.phone}\n${requestData.service}`,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">üîß</text></svg>',
                        requireInteraction: true
                    });
                }
            }
            
            showAlert(message) {
                const alert = document.createElement('div');
                alert.className = 'alert pulse';
                alert.innerHTML = message.replace(/\n/g, '<br>');
                
                // –î–æ–±–∞–≤–ª—è–µ–º –º–∏–≥–∞–Ω–∏–µ —Ñ–æ–Ω–∞ –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è
                let blinkCount = 0;
                const blinkInterval = setInterval(() => {
                    document.body.style.backgroundColor = blinkCount % 2 === 0 ? '#ff4444' : '';
                    blinkCount++;
                    if (blinkCount > 6) {
                        clearInterval(blinkInterval);
                        document.body.style.backgroundColor = '';
                    }
                }, 200);
                
                document.body.appendChild(alert);
                
                // –ê–≤—Ç–æ–∑–∞–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.remove();
                    }
                }, 10000);
                
                // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É
                alert.addEventListener('click', () => {
                    alert.remove();
                    this.stopCurrentSound(); // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–≤—É–∫
                });
            }
            
            showNotification(message) {
                const time = new Date().toLocaleTimeString('uk-UA');
                const notification = document.createElement('div');
                notification.className = 'notification-item new';
                notification.innerHTML = `
                    <div class="notification-time">${time}</div>
                    <div class="notification-content">${message}</div>
                `;
                
                const list = document.getElementById('notificationList');
                list.insertBefore(notification, list.firstChild);
                
                // –£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∞—Å—Å–∞ 'new' —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(() => {
                    notification.classList.remove('new');
                }, 3000);
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
                const notifications = list.children;
                if (notifications.length > 50) {
                    list.removeChild(notifications[notifications.length - 1]);
                }
            }
            
            addToNotificationLog(requestData) {
                const message = `üìû –ó–∞—è–≤–∫–∞: ${requestData.name} | ${requestData.service}`;
                this.showNotification(message);
            }
            
            updateVolume(value) {
                this.saveSettings();
            }
            
            saveSettings() {
                const settings = {
                    volume: document.getElementById('soundVolume').value,
                    soundType: document.getElementById('soundType').value,
                    repeatCount: document.getElementById('repeatCount').value
                };
                localStorage.setItem('pcmaster-monitor-settings', JSON.stringify(settings));
            }
            
            loadSettings() {
                const saved = localStorage.getItem('pcmaster-monitor-settings');
                if (saved) {
                    const settings = JSON.parse(saved);
                    document.getElementById('soundVolume').value = settings.volume || 80;
                    document.getElementById('soundType').value = settings.soundType || 'alarm';
                    document.getElementById('repeatCount').value = settings.repeatCount || '3';
                }
            }
            
            // Heartbeat –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            startHeartbeat() {
                setInterval(() => {
                    if (this.isMonitoring) {
                        // –ó–¥–µ—Å—å –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
                        console.log('Heartbeat: —Å–∏—Å—Ç–µ–º–∞ –∞–∫—Ç–∏–≤–Ω–∞');
                    }
                }, 30000); // –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', () => {
            const monitor = new RequestMonitor();
            window.requestMonitor = monitor; // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
        });
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.addEventListener('beforeunload', (e) => {
            if (window.requestMonitor && window.requestMonitor.isMonitoring) {
                e.preventDefault();
                e.returnValue = '–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ –∑–∞—è–≤–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏–π. –í–∏ –¥—ñ–π—Å–Ω–æ —Ö–æ—á–µ—Ç–µ –∑–∞–∫—Ä–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É?';
            }
        });
    </script>
</body>
</html>